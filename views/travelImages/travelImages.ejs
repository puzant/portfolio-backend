<div class="p-4">
  <div class="d-flex justify-content-between justify-content-md-start align-items-center gap-3">
    <h2>
      <a class="text-black" style="text-decoration: none;" data-bs-toggle="collapse" role="button" href="#travelImagesCollapse" aria-expanded="true" aria-controls="travelImagesCollapse">
        <i class="bi bi-caret-down-fill" id="travelImagesCollapseIcon"></i>
      </a>
      Travel Images
    </h2>
    <% if (userRole === 'admin') { %>
      <a href="travel-images/add">
        <h5><i class="bi bi-plus-circle-fill"></i></h5>
      </a>
    <% } %>
  </div>

  <% if (travelImages.length == 0) { %>
    <div class="alert alert-light w-25" role="alert">
      There are no Travel Images yet!
    </div>
  <% } else { %>

    <div class="container-fluid show" id="travelImagesCollapse">
      <div 
        id="<%= userRole === 'admin' ? 'admin-trave-images-container' : 'travel-images-container' %>"
        class="row row-cols-2 row-cols-sm-4 row-cols-md-6 g-4"
      >
        <% travelImages.forEach(image => { %>
          <div class="col position-relative d-flex flex-column" id="<%= image.public_id %>">
            <img class="img-thumbnail" style=" object-fit: cover; height: 180px; width: 180px;" src="<%= image.url %>" alt="">
            
            <% if (userRole === 'admin') { %>
              <div role="button" class="position-absolute top-0 bg-white p-1 rounded border">
                <a href="/travel-images/edit/<%= image._id %>"><i class="bi bi-pencil mx-1"></i></a>
                <i class="bi bi-trash3 pe-auto text-danger" data-bs-toggle="modal" data-bs-target="#deleteModal-<%= image.public_id.slice(8, image.public_id.length) %>"></i>
              </div>
            <% } %>
            <b class="small"><%= image.display_name %></b>
          </div>
          <%- include('../partials/_deleteModal', { data: {id: image.public_id.slice(8, image.public_id.length), ...image}, type: 'Travel Image' }) %>
        <% }) %>
      </div>
    </div>
  <% } %>
</div>

<script>
  const travelImagesDeleteBtns = document.querySelectorAll(".delete-btn");
  const travelImagesCollapse = document.getElementById('travelImagesCollapse');
  const travelImagesCollapseIcon = document.getElementById('travelImagesCollapseIcon');
  const travelImagesContainer = document.getElementById('admin-travel-images-container')

  travelImagesCollapse.addEventListener('hide.bs.collapse', () => {
    travelImagesCollapseIcon.classList.remove('bi-caret-down-fill');
    travelImagesCollapseIcon.classList.add('bi-caret-right-fill');
  });

  travelImagesCollapse.addEventListener('show.bs.collapse', () => {
    travelImagesCollapseIcon.classList.remove('bi-caret-right-fill');
    travelImagesCollapseIcon.classList.add('bi-caret-down-fill');
  });

  const travelImagesSortable = new Sortable(travelImagesContainer, {
    animation: 150,
    ghostClass: 'sortable-ghost', 
    onEnd: async (evt) => {
      console.log(evt)
    }
  })

  travelImagesDeleteBtns.forEach(button => {
    button.addEventListener('click', async function() {
      const travelImageId = button.getAttribute("data-id");
      const travelImagePublicId = button.getAttribute("data-public-id")

      try {
        const response = await axios({
          url: `v1/travel-images/remove/${travelImageId}`,
          method: 'delete',
          data: {
            publicId: travelImagePublicId
          }
        })
        showAlert('success', response.data.message)
      } catch (err) {
        showAlert('danger', 'An unexpected error occurred.')
      }
    })

  })
</script>